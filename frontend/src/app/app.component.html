<div class="container mt-4">
  <h1><img src="https://www.proxmox.com/images/proxmox/Proxmox_logo_standard_hex_400px.png" alt="Proxmox Logo" height="40"> Proxmox VE 管理 (Angular + FastAPI)</h1>
  <hr>

  <div *ngIf="message" class="alert alert-{{messageType}} alert-dismissible fade show" role="alert">
    {{ message }}
    <button type="button" class="btn-close" (click)="message = null" aria-label="Close"></button>
  </div>

  <h2>节点列表</h2>
  <div class="mb-3 d-flex align-items-center">
      <button class="btn btn-primary" (click)="loadNodes()" [disabled]="isLoadingNodes">
          <span *ngIf="isLoadingNodes" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          {{ isLoadingNodes ? '加载中...' : '刷新节点' }}
      </button>
      <div *ngIf="nodes.length > 0" class="ms-3">
          <label for="nodeSelect" class="form-label me-2">选择节点:</label>
          <select id="nodeSelect" class="form-select d-inline-block w-auto" [(ngModel)]="selectedNode" [disabled]="nodes.length === 0">
              <option *ngFor="let node of nodes" [value]="node.node">
                  {{ node.node }} (CPU: {{ node.cpu * 100 | number:'1.1-1' }}%, Mem: {{ (node.mem / node.maxmem * 100) | number:'1.1-1' }}%)
              </option>
          </select>
      </div>
       <div *ngIf="nodes.length === 0 && !isLoadingNodes" class="ms-3 text-muted">
          请先加载节点或检查后端连接。
       </div>
  </div>

  <h2>创建 LXC 容器</h2>
  <form #lxcForm="ngForm" (ngSubmit)="onSubmit()">
      <div class="row g-3">
          <div class="col-md-6">
              <div class="mb-3">
                  <label for="vmid" class="form-label">VMID <span class="text-danger">*</span></label>
                  <input type="number" class="form-control" id="vmid" name="vmid" [(ngModel)]="containerConfig.vmid" required #vmid="ngModel">
                  <div *ngIf="vmid.invalid && (vmid.dirty || vmid.touched)" class="invalid-feedback d-block">VMID 是必填项且必须是数字。</div>
              </div>
              <div class="mb-3">
                  <label for="hostname" class="form-label">主机名 <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="hostname" name="hostname" [(ngModel)]="containerConfig.hostname" required #hostname="ngModel">
                   <div *ngIf="hostname.invalid && (hostname.dirty || hostname.touched)" class="invalid-feedback d-block">主机名是必填项。</div>
              </div>
              <div class="mb-3">
                  <label for="password" class="form-label">密码 <span class="text-danger">*</span></label>
                  <input type="password" class="form-control" id="password" name="password" [(ngModel)]="containerConfig.password" required minlength="6" #password="ngModel">
                   <div *ngIf="password.invalid && (password.dirty || password.touched)" class="invalid-feedback d-block">
                       <span *ngIf="password.errors?.['required']">密码是必填项。</span>
                       <span *ngIf="password.errors?.['minlength']">密码至少需要 6 位。</span>
                   </div>
              </div>
               <div class="mb-3">
                  <label for="ostemplate" class="form-label">系统模板 <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="ostemplate" name="ostemplate" [(ngModel)]="containerConfig.ostemplate" required placeholder="例如: local:vztmpl/ubuntu-22.04..." #ostemplate="ngModel">
                   <div *ngIf="ostemplate.invalid && (ostemplate.dirty || ostemplate.touched)" class="invalid-feedback d-block">系统模板是必填项。</div>
              </div>
          </div>
          <div class="col-md-6">
              <div class="mb-3">
                  <label for="storage" class="form-label">存储 <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="storage" name="storage" [(ngModel)]="containerConfig.storage" required placeholder="例如: local-lvm" #storage="ngModel">
                   <div *ngIf="storage.invalid && (storage.dirty || storage.touched)" class="invalid-feedback d-block">存储是必填项。</div>
              </div>
              <div class="mb-3">
                  <label for="net0" class="form-label">网络 (net0) <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="net0" name="net0" [(ngModel)]="containerConfig.net0" required placeholder="例如: name=eth0,bridge=vmbr0,ip=dhcp" #net0="ngModel">
                   <div *ngIf="net0.invalid && (net0.dirty || net0.touched)" class="invalid-feedback d-block">网络配置是必填项。</div>
              </div>
              <div class="row">
                  <div class="col-md-4">
                      <label for="cores" class="form-label">CPU核心</label>
                      <input type="number" class="form-control" id="cores" name="cores" [(ngModel)]="containerConfig.cores" min="1">
                  </div>
                  <div class="col-md-4">
                      <label for="memory" class="form-label">内存 (MB)</label>
                      <input type="number" class="form-control" id="memory" name="memory" [(ngModel)]="containerConfig.memory" min="128">
                  </div>
                  <div class="col-md-4">
                      <label for="swap" class="form-label">SWAP (MB)</label>
                      <input type="number" class="form-control" id="swap" name="swap" [(ngModel)]="containerConfig.swap" min="0">
                  </div>
              </div>
          </div>
      </div>
      <button type="submit" class="btn btn-success mt-3" [disabled]="!lxcForm.form.valid || !selectedNode || isCreating">
          <span *ngIf="isCreating" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          {{ isCreating ? '创建中...' : '创建容器' }}
      </button>
  </form>

</div>
